<!DOCTYPE html>
<html>
<head>
	<h1>Manager Page</h1>
	<script src="http://www.parsecdn.com/js/parse-1.2.18.min.js"></script>
	<script src="http://code.jquery.com/jquery-1.11.1.js"></script>

	<!-- for drop down menu-->
	<script src="js/vendor/jquery.js"></script> 
	<script src="js/foundation/foundation.js"></script> 
	<script src="js/foundation/foundation.dropdown.js"></script>
</head>
<body>
	<p>Congrats you have logged in</p>
	<input type="text" id="Esearch">Search Employee (username)<br>
	<button onclick="searchFunction()">Search</button><br>
	<button onclick="logoutFunction()">Log Out</button><br>
	<button>Approve Hours</button>
	<button onclick="managerHistoryFunction()">History</button>
	
	<p>For right now once you logout and go back just refresh the page and you will see the you are logged into change.</p>
	<p>Also need to connect approve button to a payroll program</p>
	<p>I'll change it in a bit to use the full name of the employee instead of the username</p>
	<p id="test"></P>
	<p id="test2">Shows employee's history</p>


	<script>

	var stringTest = '';
	stringTest = stringTest + '<table>';
	//when manager searches for employee make sure to match the employee's company with the managers company so a manager from a given compnay can only see his employees and no one elses. 
	//figure out how you will add roles to the database (probs manually or maybe a CSV file?)
	//need to implement manager history function to view employee history given a work week date. Copy code for employee html. 
	Parse.initialize("VHJSk9hmfDIoXsrRE3V7KWM6KHkncJwYfslUp10A", "qQzcr3LyCEAFf3yzxUmZh1LKy7EBmfxXw8vV6SMB");

	var currentUser = Parse.User.current();
	var UN = currentUser.get("username");
	var C = currentUser.get("company");
	document.getElementById("test").innerHTML = "YOU ARE LOGGED INTO: " + UN;

	
	function searchFunction() {

		var totalHrs = 0;
		var timeSheet = Parse.Object.extend("TimeSheet");
		var query = new Parse.Query(timeSheet);
		
		query.equalTo("username", document.getElementById("Esearch").value);
		query.descending("Date");
		//query.limit(7); //7 days of the week most recent entries
		query.find({
			success: function(results) {
				//do something with the returned Parse.Object values
					//var object1 = results[0];
					stringTest = stringTest + ('<table border="1" cellspacing="1" cellpadding="5">');
					stringTest = stringTest + ('<tr><td>' + 'Employee Name: ' + '</td><td>' + results[0].get('FirstName') + '</td><td>' + results[0].get('LastName') + '</td><tr>');
					stringTest = stringTest + ('<tr><td>Date</td><td>Time In</td><td>Time Out</td><tr>');

					for (var i = 0; i < 7; i++) {
						var object = results[i];
						totalHrs = totalHrs + (object.get('timeOutMilitary') - object.get('timeInMilitary'));
						stringTest = stringTest + ('<tr><td>' + object.get('Date') + '</td><td>' + object.get('timeIn') + '</td><td>' + object.get('timeOut') + '</td></tr>'); 
					}
					stringTest = stringTest + ('<tr><td>' + "Total Hours:" + '</td><td>' + totalHrs/60.0 + '</td><td></td></tr>');
					stringTest = stringTest + '</table>';
				
				},
				error: function(error) {
					alert("Error: User Does not exist");
				}
			});
			document.getElementById("test2").innerHTML = stringTest;
	}


	function logoutFunction() {
		Parse.User.logOut();

		window.location="timeConnectWebLogin.html";
	}
	

	function managerHistoryFunction() {

	}
	</script>
</body>
</html>